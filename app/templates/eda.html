{% extends "base.html" %}

{% block title %}EDA Analysis - Sales Prediction Dashboard{% endblock %}

{% block content %}
<!-- Header Section -->
<div class="main-header">
    <div class="container">
        <h1><i class="fas fa-search-plus me-3"></i>Exploratory Data Analysis</h1>
        <p>Discover key relationships between the most important features for sales prediction</p>
    </div>
</div>

<div class="container">
    <!-- Key Insights Summary -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="chart-container">
                <h3 class="mb-3"><i class="fas fa-lightbulb me-2 text-warning"></i>Key Insights</h3>
                <div class="row">
                    {% for insight in insights %}
                    <div class="col-md-6 col-lg-4 mb-3">
                        <div class="alert alert-info mb-0">
                            <i class="fas fa-info-circle me-2"></i>{{ insight }}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Visualization 1: Price vs Sales Success -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="chart-container">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3><i class="fas fa-dollar-sign me-2 text-success"></i>Price vs Sales Success Analysis</h3>
                    <span class="badge bg-primary">Visualization 1</span>
                </div>
                <p class="text-muted mb-4">
                    This analysis reveals how pricing strategy impacts sales performance. It shows the relationship between 
                    product prices, price competitiveness, and sales success rates across different price ranges.
                </p>
                <div id="price-sales-chart" class="chart-plot"></div>
            </div>
        </div>
    </div>

    <!-- Visualization 2: Promotion Impact -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="chart-container">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3><i class="fas fa-tags me-2 text-warning"></i>Promotion Impact Analysis</h3>
                    <span class="badge bg-success">Visualization 2</span>
                </div>
                <p class="text-muted mb-4">
                    Explore how different promotion strategies affect sales outcomes. This analysis compares the effectiveness 
                    of various promotion types and their impact on revenue and sales success rates.
                </p>
                <div id="promotion-impact-chart" class="chart-plot"></div>
            </div>
        </div>
    </div>

    <!-- Visualization 3: Location and Customer Segment -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="chart-container">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3><i class="fas fa-map-marker-alt me-2 text-info"></i>Location & Customer Segment Analysis</h3>
                    <span class="badge bg-info">Visualization 3</span>
                </div>
                <p class="text-muted mb-4">
                    Understand how geographic and demographic factors influence sales performance. This analysis examines 
                    the relationship between store locations, customer segments, and sales success patterns.
                </p>
                <div id="location-customer-chart" class="chart-plot"></div>
            </div>
        </div>
    </div>

    <!-- Analysis Summary -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="chart-container">
                <h3 class="mb-3"><i class="fas fa-chart-line me-2 text-primary"></i>Analysis Summary</h3>
                <div class="row">
                    <div class="col-md-4">
                        <div class="metric-card text-center">
                            <div class="metric-value text-success">Price Strategy</div>
                            <div class="metric-label">Key Factor #1</div>
                            <p class="mt-2 text-muted">Optimal pricing relative to competitors significantly impacts sales success</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="metric-card text-center">
                            <div class="metric-value text-warning">Promotions</div>
                            <div class="metric-label">Key Factor #2</div>
                            <p class="mt-2 text-muted">Strategic promotions can boost sales performance when properly targeted</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="metric-card text-center">
                            <div class="metric-value text-info">Location & Segment</div>
                            <div class="metric-label">Key Factor #3</div>
                            <p class="mt-2 text-muted">Geographic and demographic targeting enhances sales effectiveness</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recommendations -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="chart-container">
                <h3 class="mb-3"><i class="fas fa-recommendations me-2 text-success"></i>Business Recommendations</h3>
                <div class="row">
                    <div class="col-md-6">
                        <div class="alert alert-success">
                            <h5><i class="fas fa-check-circle me-2"></i>Pricing Optimization</h5>
                            <ul class="mb-0">
                                <li>Monitor competitor pricing regularly</li>
                                <li>Adjust prices based on market positioning</li>
                                <li>Consider value-based pricing for premium segments</li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="alert alert-warning">
                            <h5><i class="fas fa-exclamation-triangle me-2"></i>Promotion Strategy</h5>
                            <ul class="mb-0">
                                <li>Target promotions to specific customer segments</li>
                                <li>Measure promotion lift and ROI</li>
                                <li>Test different promotion types for effectiveness</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-6">
                        <div class="alert alert-info">
                            <h5><i class="fas fa-map-marked-alt me-2"></i>Location Strategy</h5>
                            <ul class="mb-0">
                                <li>Tailor product mix to local demographics</li>
                                <li>Optimize inventory based on location performance</li>
                                <li>Consider expansion in high-performing areas</li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="alert alert-primary">
                            <h5><i class="fas fa-users me-2"></i>Customer Segmentation</h5>
                            <ul class="mb-0">
                                <li>Develop segment-specific marketing campaigns</li>
                                <li>Customize product offerings by segment</li>
                                <li>Track segment performance over time</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .chart-plot {
        min-height: 600px;
        width: 100%;
    }
    
    .alert {
        border-left: 4px solid;
    }
    
    .alert-success {
        border-left-color: #28a745;
    }
    
    .alert-warning {
        border-left-color: #ffc107;
    }
    
    .alert-info {
        border-left-color: #17a2b8;
    }
    
    .alert-primary {
        border-left-color: #007bff;
    }
    
    .badge {
        font-size: 0.8rem;
        padding: 0.5rem 1rem;
    }
    
    .metric-card {
        transition: all 0.3s ease;
    }
    
    .metric-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    // Render Price vs Sales Success Chart
    const priceSalesData = JSON.parse('{{ price_sales_chart|safe }}');

    Plotly.newPlot('price-sales-chart', priceSalesData.data, priceSalesData.layout, {
        responsive: true,
        displayModeBar: true,
        modeBarButtonsToRemove: ['pan2d', 'lasso2d', 'select2d'],
        displaylogo: false
    });
    
    // Render Promotion Impact Chart
    const promotionImpactData = JSON.parse('{{ promotion_impact_chart|safe }}');
    Plotly.newPlot('promotion-impact-chart', promotionImpactData.data, promotionImpactData.layout, {
        responsive: true,
        displayModeBar: true,
        modeBarButtonsToRemove: ['pan2d', 'lasso2d', 'select2d'],
        displaylogo: false
    });
    
    // Render Location & Customer Segment Chart
    const locationCustomerData = JSON.parse('{{ location_customer_chart|safe }}');
    Plotly.newPlot('location-customer-chart', locationCustomerData.data, locationCustomerData.layout, {
        responsive: true,
        displayModeBar: true,
        modeBarButtonsToRemove: ['pan2d', 'lasso2d', 'select2d'],
        displaylogo: false
    });
    
    // Add loading states and error handling
    document.addEventListener('DOMContentLoaded', function() {
        // Add smooth scrolling for better UX
        const badges = document.querySelectorAll('.badge');
        badges.forEach(badge => {
            badge.style.cursor = 'pointer';
            badge.addEventListener('click', function() {
                const chartContainer = this.closest('.chart-container');
                const chartDiv = chartContainer.querySelector('.chart-plot');
                chartDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
            });
        });
        
        // Add chart resize handling
        window.addEventListener('resize', function() {
            Plotly.Plots.resize('price-sales-chart');
            Plotly.Plots.resize('promotion-impact-chart');
            Plotly.Plots.resize('location-customer-chart');
        });
    });
</script>
{% endblock %}